
Array.prototype.arrSort2 = function (fn) {
    var fn = fn || function (a, b) { return a <= b; };
    for (var i = 0; i < this.length; i++) {
        for (var j = i; j < this.length; j++) {
            if (fn(this[i], this[j]) > 0) {
                var t = this[i];
                this[i] = this[j];
                this[j] = t;
            }
        }
    }
    return this;
};
window.console = window.console || (function () {
    var c = {};
    c.log = c.warn = c.debug = c.info = c.error = c.time = c.dir = c.profile = c.clear = c.exception = c.trace = c.assert = function () { };
    return c;
})();
var isOp = true;
var isType = 0;
//js调用
// 1 模式，2 危险等级，3 IP
function sort(stype, bthis) {
    $(".BLACK").show();
    //console.time("pxcx方法执行时间：");
    var imgId = stype == 1 ? "modeImg" : (stype == 2 ? "preilImg" : "IPImg");
    $("#preilImg").attr("src", "Css/images/sort.gif").parent().css("background-color", "");
    $("#modeImg").attr("src", "Css/images/sort.gif").parent().css("background-color", "");
    $("#IPImg").attr("src", "Css/images/sort.gif").parent().css("background-color", "");
    setTimeout(function () {
        if (stype == isType) {
            //恢复原排序
            pxcx("divCookie", "js-dxls", stype, false);
            isType = 0;
        } else {
            //根据当前点击的类型排序
            pxcx("divCookie", "js-dxls", stype, true);
            $(bthis).css("background-color", "#ea3232");
            $("#" + imgId).attr("src", "Css/images/desc.gif");
            isType = stype;
        }
        //console.timeEnd("pxcx方法执行时间：");
    }, 10);
}
function Persion(ssite, index, shtml, sacc) {
    this.ssite = ssite;
    this.index = index;
    this.shtml = shtml;
    this.sacc = sacc;
}
//排序和查询
function pxcx(divtcher, dxls, stype, opp) {
    var ary = new Array();
    var sortId = 0;
    var site = 0;
    var acc = "";
    $("#" + divtcher + " ." + dxls + "").each(function () {
        if (opp) {
            if (stype == 1) {
                sortId = parseInt($(this).attr("data-sort")) == 999 ? parseInt($("#modeLen").val()) : parseInt($(this).attr("data-sort"));
            } else if (stype == 2) {
                sortId = parseInt($(this).attr("data-preil")) == 999 ? parseInt($("#preilLen").val()) : parseInt($(this).attr("data-preil"));
            } else if (stype == 3) {
                sortId = parseInt($(this).attr("data-ipsort")) == 999 ? parseInt($("#IPLen").val()) : parseInt($(this).attr("data-ipsort"));
            }
            site = parseInt($(this).attr("data-site"));
            acc = $(this).attr("data-acc");
        } else {
            sortId = parseInt($(this).attr("data-index"));
        }
        //拿到当前模式在数组中的下表，插入当前ul的html
        ary.push(new Persion((opp ? site : 0), sortId, $("<p>").append($(this)).html(), acc));
    });
    if (opp) {
        //加一个冒泡排序 并且再按照账号排
        ary.arrSort2(function (a, b) {
            if (a.index == b.index) {
                if (a.ssite == b.ssite) {
                    return a.sacc >= b.sacc;
                }
                //如果模式相同再按照站点排序
                return a.ssite - b.ssite;
            }
            else {
                return a.index - b.index;
            }
        });
    } else {
        ary.sort(function (a, b) {
            return a.index - b.index;
        });
    }
    $("#" + divtcher + " .js-dxls").remove();
    var sumHtml = $("#sumDiv").prop("outerHTML");
    $("#sumDiv").remove();
    //循环遍历数组将html拼接
    //使用DocumentFragment加快DOM渲染速度 
    var fragment = document.createDocumentFragment();
    for (var i = 0; i < ary.length; i++) {
        var tmpNode = document.createElement("div");
        tmpNode.innerHTML = ary[i].shtml;
        fragment.appendChild(tmpNode.firstChild);
    }
    document.getElementById(divtcher).appendChild(fragment);
    //合计
    $("#" + divtcher).append(sumHtml);
    $(".BLACK").hide();
}
